(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{577:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return r(694)}])},5452:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(1134).Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},4976:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(1134).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},3416:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(1134).Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},9176:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(1134).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},4109:function(e,t,r){"use strict";r.d(t,{C:function(){return l}});var s=r(5893);r(7294);var a=r(2003),n=r(5156);let i=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:r,...a}=e;return(0,s.jsx)("div",{className:(0,n.cn)(i({variant:r}),t),...a})}},9346:function(e,t,r){"use strict";r.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return i},aY:function(){return o},ll:function(){return d}});var s=r(5893),a=r(7294),n=r(5156);let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});i.displayName="Card";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...a})});l.displayName="CardHeader";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});d.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...a})});c.displayName="CardDescription";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...a})});o.displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},1202:function(e,t,r){"use strict";r.d(t,{mQ:function(){return Z},nU:function(){return S},dr:function(){return T},SP:function(){return O}});var s=r(5893),a=r(7294),n=r(6206),i=r(5360),l=r(650),d=r(9115),c=r(5320),o=r(8990),u=r(7342),f=r(1276),m="Tabs",[x,h]=(0,i.b)(m,[l.Pc]),v=(0,l.Pc)(),[p,j]=x(m),b=a.forwardRef((e,t)=>{let{__scopeTabs:r,value:a,onValueChange:n,defaultValue:i,orientation:l="horizontal",dir:d,activationMode:m="automatic",...x}=e,h=(0,o.gm)(d),[v,j]=(0,u.T)({prop:a,onChange:n,defaultProp:i});return(0,s.jsx)(p,{scope:r,baseId:(0,f.M)(),value:v,onValueChange:j,orientation:l,dir:h,activationMode:m,children:(0,s.jsx)(c.WV.div,{dir:h,"data-orientation":l,...x,ref:t})})});b.displayName=m;var y="TabsList",g=a.forwardRef((e,t)=>{let{__scopeTabs:r,loop:a=!0,...n}=e,i=j(y,r),d=v(r);return(0,s.jsx)(l.fC,{asChild:!0,...d,orientation:i.orientation,dir:i.dir,loop:a,children:(0,s.jsx)(c.WV.div,{role:"tablist","aria-orientation":i.orientation,...n,ref:t})})});g.displayName=y;var N="TabsTrigger",w=a.forwardRef((e,t)=>{let{__scopeTabs:r,value:a,disabled:i=!1,...d}=e,o=j(N,r),u=v(r),f=_(o.baseId,a),m=R(o.baseId,a),x=a===o.value;return(0,s.jsx)(l.ck,{asChild:!0,...u,focusable:!i,active:x,children:(0,s.jsx)(c.WV.button,{type:"button",role:"tab","aria-selected":x,"aria-controls":m,"data-state":x?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:f,...d,ref:t,onMouseDown:(0,n.M)(e.onMouseDown,e=>{i||0!==e.button||!1!==e.ctrlKey?e.preventDefault():o.onValueChange(a)}),onKeyDown:(0,n.M)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&o.onValueChange(a)}),onFocus:(0,n.M)(e.onFocus,()=>{let e="manual"!==o.activationMode;x||i||!e||o.onValueChange(a)})})})});w.displayName=N;var k="TabsContent",C=a.forwardRef((e,t)=>{let{__scopeTabs:r,value:n,forceMount:i,children:l,...o}=e,u=j(k,r),f=_(u.baseId,n),m=R(u.baseId,n),x=n===u.value,h=a.useRef(x);return a.useEffect(()=>{let e=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,s.jsx)(d.z,{present:i||x,children:({present:r})=>(0,s.jsx)(c.WV.div,{"data-state":x?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":f,hidden:!r,id:m,tabIndex:0,...o,ref:t,style:{...e.style,animationDuration:h.current?"0s":void 0},children:r&&l})})});function _(e,t){return`${e}-trigger-${t}`}function R(e,t){return`${e}-content-${t}`}C.displayName=k;var M=r(5156);let Z=b,T=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(g,{ref:t,className:(0,M.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...a})});T.displayName=g.displayName;let O=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(w,{ref:t,className:(0,M.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...a})});O.displayName=w.displayName;let S=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(C,{ref:t,className:(0,M.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...a})});S.displayName=C.displayName},694:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return T}});var s=r(5893),a=r(7294),n=r(837),i=r(9346),l=r(4109),d=r(8778),c=r(1202),o=r(5156);let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:(0,o.cn)("w-full caption-bottom text-sm",r),...a})})});u.displayName="Table";let f=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("thead",{ref:t,className:(0,o.cn)("[&_tr]:border-b",r),...a})});f.displayName="TableHeader";let m=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("tbody",{ref:t,className:(0,o.cn)("[&_tr:last-child]:border-0",r),...a})});m.displayName="TableBody",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("tfoot",{ref:t,className:(0,o.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...a})}).displayName="TableFooter";let x=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("tr",{ref:t,className:(0,o.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...a})});x.displayName="TableRow";let h=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("th",{ref:t,className:(0,o.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...a})});h.displayName="TableHead";let v=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("td",{ref:t,className:(0,o.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...a})});v.displayName="TableCell",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("caption",{ref:t,className:(0,o.cn)("mt-4 text-sm text-muted-foreground",r),...a})}).displayName="TableCaption";var p=r(6731),j=r(3214),b=r(4976),y=r(9176),g=r(1134);let N=(0,g.Z)("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);var w=r(5452);function k(){let[e,t]=(0,a.useState)([]),[r,n]=(0,a.useState)({}),[o,g]=(0,a.useState)(!0),{toast:k}=(0,p.pm)(),C=async()=>{try{let{data:e,error:r}=await j.O.functions.invoke("admin-dashboard",{body:{action:"get_users"}});if(r)throw r;t(e.users||[])}catch(e){k({title:"Error",description:e.message,variant:"destructive"})}},_=async()=>{try{let{data:e,error:t}=await j.O.functions.invoke("admin-dashboard",{body:{action:"get_chat_stats"}});if(t)throw t;n(e.chatStats||{})}catch(e){k({title:"Error",description:e.message,variant:"destructive"})}},R=async e=>{try{let{error:t}=await j.O.functions.invoke("admin-dashboard",{body:{action:"reset_user_conversations",userId:e}});if(t)throw t;k({title:"Success",description:"User conversations reset successfully"}),C()}catch(e){k({title:"Error",description:e.message,variant:"destructive"})}};(0,a.useEffect)(()=>{(async()=>{g(!0),await Promise.all([C(),_()]),g(!1)})()},[]);let M=e.length,Z=e.filter(e=>{var t;return null===(t=e.subscriptions)||void 0===t?void 0:t.some(e=>"active"===e.status)}).length,T=Object.values(r).reduce((e,t)=>e+t,0);return o?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):(0,s.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Admin Dashboard"}),(0,s.jsxs)(d.z,{onClick:()=>{C(),_()},variant:"outline",children:[(0,s.jsx)(b.Z,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,s.jsxs)(i.Zb,{children:[(0,s.jsxs)(i.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(i.ll,{className:"text-sm font-medium",children:"Total Users"}),(0,s.jsx)(y.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsx)(i.aY,{children:(0,s.jsx)("div",{className:"text-2xl font-bold",children:M})})]}),(0,s.jsxs)(i.Zb,{children:[(0,s.jsxs)(i.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(i.ll,{className:"text-sm font-medium",children:"Active Subscriptions"}),(0,s.jsx)(N,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsx)(i.aY,{children:(0,s.jsx)("div",{className:"text-2xl font-bold",children:Z})})]}),(0,s.jsxs)(i.Zb,{children:[(0,s.jsxs)(i.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(i.ll,{className:"text-sm font-medium",children:"Conversations (30d)"}),(0,s.jsx)(w.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsx)(i.aY,{children:(0,s.jsx)("div",{className:"text-2xl font-bold",children:T})})]})]}),(0,s.jsxs)(c.mQ,{defaultValue:"users",className:"space-y-4",children:[(0,s.jsxs)(c.dr,{children:[(0,s.jsx)(c.SP,{value:"users",children:"Users"}),(0,s.jsx)(c.SP,{value:"analytics",children:"Analytics"})]}),(0,s.jsx)(c.nU,{value:"users",className:"space-y-4",children:(0,s.jsxs)(i.Zb,{children:[(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{children:"User Management"})}),(0,s.jsx)(i.aY,{children:(0,s.jsxs)(u,{children:[(0,s.jsx)(f,{children:(0,s.jsxs)(x,{children:[(0,s.jsx)(h,{children:"Email"}),(0,s.jsx)(h,{children:"Name"}),(0,s.jsx)(h,{children:"Plan"}),(0,s.jsx)(h,{children:"Conversations Used"}),(0,s.jsx)(h,{children:"Last Reset"}),(0,s.jsx)(h,{children:"Actions"})]})}),(0,s.jsx)(m,{children:e.map(e=>{var t,r;return(0,s.jsxs)(x,{children:[(0,s.jsx)(v,{className:"font-medium",children:e.email}),(0,s.jsx)(v,{children:e.full_name||"N/A"}),(0,s.jsx)(v,{children:(0,s.jsx)(l.C,{variant:"free"===e.plan?"secondary":"default",children:(null===(r=e.subscriptions)||void 0===r?void 0:null===(t=r[0])||void 0===t?void 0:t.plan_name)||e.plan||"free"})}),(0,s.jsx)(v,{children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{children:e.conversations_used||0}),"free"===e.plan&&(0,s.jsx)("span",{className:"text-muted-foreground",children:"/ 100"})]})}),(0,s.jsx)(v,{children:e.last_reset_date?new Date(e.last_reset_date).toLocaleDateString():"Never"}),(0,s.jsx)(v,{children:(0,s.jsx)(d.z,{size:"sm",variant:"outline",onClick:()=>R(e.user_id),children:"Reset Count"})})]},e.user_id)})})]})})]})}),(0,s.jsx)(c.nU,{value:"analytics",className:"space-y-4",children:(0,s.jsxs)(i.Zb,{children:[(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{children:"Conversation Analytics (Last 30 Days)"})}),(0,s.jsx)(i.aY,{children:(0,s.jsx)("div",{className:"space-y-2",children:Object.entries(r).sort((e,t)=>{let[r]=e,[s]=t;return s.localeCompare(r)}).slice(0,10).map(e=>{let[t,r]=e;return(0,s.jsxs)("div",{className:"flex justify-between items-center p-2 rounded bg-muted/50",children:[(0,s.jsx)("span",{children:new Date(t).toLocaleDateString()}),(0,s.jsxs)(l.C,{variant:"outline",children:[r," conversations"]})]},t)})})})]})})]})]})}let C=(0,r(2003).j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),_=a.forwardRef((e,t)=>{let{className:r,variant:a,...n}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,o.cn)(C({variant:a}),r),...n})});_.displayName="Alert",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("h5",{ref:t,className:(0,o.cn)("mb-1 font-medium leading-none tracking-tight",r),...a})}).displayName="AlertTitle";let R=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("text-sm [&_p]:leading-relaxed",r),...a})});R.displayName="AlertDescription";var M=r(3416);let Z=(0,g.Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);function T(){let{user:e,loading:t}=(0,n.a)(),[r,l]=(0,a.useState)(!1),[d,c]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{(async()=>{if(!e){c(!1);return}try{let{data:r,error:s}=await j.O.from("profiles").select("is_admin").eq("user_id",e.id);if(s)console.error("Error checking admin status:",s),l(!1);else{var t;l((null==r?void 0:null===(t=r[0])||void 0===t?void 0:t.is_admin)||!1)}}catch(e){console.error("Error:",e),l(!1)}finally{c(!1)}})()},[e]),t||d)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e?r?(0,s.jsx)(k,{}):(0,s.jsx)("div",{className:"container mx-auto p-6",children:(0,s.jsxs)(i.Zb,{className:"max-w-md mx-auto",children:[(0,s.jsx)(i.Ol,{children:(0,s.jsxs)(i.ll,{className:"flex items-center space-x-2",children:[(0,s.jsx)(M.Z,{className:"h-5 w-5"}),(0,s.jsx)("span",{children:"Access Denied"})]})}),(0,s.jsx)(i.aY,{children:(0,s.jsxs)(_,{variant:"destructive",children:[(0,s.jsx)(Z,{className:"h-4 w-4"}),(0,s.jsx)(R,{children:"You do not have administrator privileges to access this page."})]})})]})}):(0,s.jsx)("div",{className:"container mx-auto p-6",children:(0,s.jsxs)(i.Zb,{className:"max-w-md mx-auto",children:[(0,s.jsx)(i.Ol,{children:(0,s.jsxs)(i.ll,{className:"flex items-center space-x-2",children:[(0,s.jsx)(M.Z,{className:"h-5 w-5"}),(0,s.jsx)("span",{children:"Authentication Required"})]})}),(0,s.jsx)(i.aY,{children:(0,s.jsxs)(_,{children:[(0,s.jsx)(Z,{className:"h-4 w-4"}),(0,s.jsx)(R,{children:"You must be logged in to access the admin panel."})]})})]})})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=577)}),_N_E=e.O()}]);